{"filter":false,"title":"Template.yml","tooltip":"/Template.yml","undoManager":{"mark":1,"position":1,"stack":[[{"start":{"row":0,"column":0},"end":{"row":266,"column":0},"action":"insert","lines":["Transform: AWS::Serverless-2016-10-31","","Parameters:","  VPCRDS:","    Type: 'List<AWS::EC2::VPC::Id>'","    Description: Name of VPC where RDS resides","  SG:","    Type: 'List<AWS::EC2::SecurityGroup::Id>'","    Description: Name of Security Group","  SUB:","    Type: 'List<AWS::EC2::Subnet::Id>'","    Description: Name of Subents","  SM1:","    Type: String","    Description: Secrets Name for Database access","  SM2:","    Type: String","    Description: Secrets Name for Cognito Keys","  ROLEARN1:","    Type: String","    Description: ARN for Database Lambdas","  ROLEARN2:","    Type: String","    Description: Role ARN for Cognito Lambdas","  COGNITO:","    Type: String","    Description: Name of the cognito Authorizer","","","Description:","  SAM template to create Cloud Native Environment for Rocket CX","","","Resources:","  MyApi:","    Type: AWS::Serverless::Api","    Properties:","      StageName: Prod","      Cors: \"'*'\"","      Auth:","        Authorizers:","          MyCognitoAuthorizer:","            UserPoolArn: !GetAtt COGNITO.Arn","            Identity:","              Header: Authorization","","","  RDSPOSTLambda:","    Type: 'AWS::Serverless::Function'","    Properties:","      Runtime: python3.6","      Timeout: 5","      FunctionName: RDS_POST_Lambda_1","      Handler: index.lambda_handler","      CodeUri: Usage_Layer.py","      Role:","        !Ref ROLEARN1","      VpcConfig:","        SecurityGroupIds:","          !Ref SG","        SubnetIds:","          !Ref SUB","      Environment:","        Variables:","          SECRETS_DB: !Ref SM1","      Events:","        ApiEvent:","          Type: Api","          Properties:","            RestApiId: !Ref MyApi","            Path: /instance/{instance}/usage","            Method: POST","            # NOTE: This endpoint is publicly accessible","            Auth:","              Authorizer: !Ref MyCognitoAuthorizer","","","","","  RDSGETLambda:","    Type: 'AWS::Serverless::Function'","    Properties:","      Runtime: python3.6","      Timeout: 5","      FunctionName: Get_request_1","      Handler: index.lambda_handler","      CodeUri: Get.py","      Role:","        !Ref ROLEARN1","      VpcConfig:","        SecurityGroupIds:","          !Ref SG","        SubnetIds:","          !Ref SUB","      Environment:","        Variables:","          SECRETS_DB: !Ref SM1","      Events:","        ApiEvent:","          Type: Api","          Properties:","              RestApiId: !Ref MyApi","              Path: /instance/{instance-id}/usage","              Method: GET","              # NOTE: This endpoint is publicly accessible","              Auth:","                Authorizer: !Ref MyCognitoAuthorizer","                OAuthScopes: billing-api/create_billing","","","  COGNITOusertoken:","    Type: 'AWS::Serverless::Function'","    Properties:","      Runtime: python3.6","      Timeout: 5","      FunctionName: Cog_user_token_1","      Handler: Cognito-User-Token.lambda_handler","      CodeUri: Cognito-User-Token.py","      Role:","        !Ref ROLEARN2","      Environment:","        Variables:","          SECRETS_DB: !Ref SM2","      Events:","        ApiEvent:","          Type: Api","          Properties:","            RestApiId: !Ref MyApi","            Path: /cognito/token","            Method: POST","            # NOTE: This endpoint is publicly accessible","            Auth:","              Authorizer: NONE","      ","      ","","","  COGNITOConfirmPass:","    Type: 'AWS::Serverless::Function'","    Properties:","      Runtime: python3.6","      Timeout: 5","      FunctionName: CognitoConfirmForgotPassword_1","      Handler: CognitoConfirmForgotPassword.lambda_handler","      CodeUri: CognitoConfirmForgotPassword.py","      Role:","        !Ref ROLEARN2","      Environment:","        Variables:","          SECRETS_DB: !Ref SM2","      Events:","        ApiEvent: ","          Type: Api","          Properties:","            RestApiId: !Ref MyApi","            Path: /cognito/confirm-forgot-password","            Method: POST","            # NOTE: This endpoint is publicly accessible","            Auth:","              Authorizer: !Ref MyCognitoAuthorizer","              OAuthScopes: billing-api/create_billing","","","  COGNITOConfirmSignup:","    Type: 'AWS::Serverless::Function'","    Properties:","      Runtime: python3.6","      Timeout: 5","      FunctionName: CognitoConfirmSignup_1","      Handler: CognitoConfirmSignup.lambda_handler","      CodeUri: CognitoConfirmSignup.py","      Role:","        !Ref ROLEARN2","      Environment:","        Variables:","          SECRETS_DB: !Ref SM2","      Events:","        ApiEvent:","          Type: Api","          Properties:          ","            RestApiId: !Ref MyApi","            Path: /cognito/confirm-signup","            Method: PUT","            # NOTE: This endpoint is publicly accessible","            Auth:","              Authorizer: !Ref MyCognitoAuthorizer","              OAuthScopes: billing-api/create_billing","","","  COGNITOforgotpass:","    Type: 'AWS::Serverless::Function'","    Properties:","      Runtime: python3.6","      Timeout: 5","      FunctionName: CognitoForgotPassword_1","      Handler: CognitoForgotPassword.lambda_handler","      CodeUri: CognitoForgotPassword.py","      Role:","        !Ref ROLEARN2","      Environment:","        Variables:","          SECRETS_DB: !Ref SM2","      Events:","        ApiEvent:","          Type: Api","          Properties:","            RestApiId: !Ref MyApi","            Path: /cognito/forgot-password","            Method: POST","            # NOTE: This endpoint is publicly accessible","            Auth:","              Authorizer: !Ref MyCognitoAuthorizer","              OAuthScopes: billing-api/create_billing","","","  COGNITOresendcode:","    Type: 'AWS::Serverless::Function'","    Properties:","      Runtime: python3.6","      Timeout: 5","      FunctionName: CognitoResendVerificationCode_1","      Handler: CognitoResendVerificationCode.lambda_handler","      CodeUri: CognitoResendVerificationCode.py","      Role:","        !Ref ROLEARN2","      Environment:","        Variables:","          SECRETS_DB: !Ref SM2","      Events:","        ApiEvent:","          Type: Api","          Properties:","            RestApiId: !Ref MyApi","            Path: /cognito/resend-verification-code","            Method: POST","            # NOTE: This endpoint is publicly accessible","            Auth:","              Authorizer: !Ref MyCognitoAuthorizer","              OAuthScopes: billing-api/create_billing","","","  COGNITOPoolsignup:","    Type: 'AWS::Serverless::Function'","    Properties:","      Runtime: python3.6","      Timeout: 5","      FunctionName: CognitoUserPoolSignUp_1","      Handler: CognitoUserPoolSignUp.lambda_handler","      CodeUri: CognitoUserPoolSignUp.py","      Role:","        !Ref ROLEARN2","      Environment:","        Variables:","          SECRETS_DB: !Ref SM2","      Events:","        ApiEvent:","          Type: Api","          Properties:","            RestApiId: !Ref MyApi","            Path: /cognito/signup","            Method: POST","            # NOTE: This endpoint is publicly accessible","            Auth:","              Authorizer: !Ref MyCognitoAuthorizer","              OAuthScopes: billing-api/create_billing","      ",""],"id":1}],[{"start":{"row":0,"column":37},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":2}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":7,"column":5},"end":{"row":7,"column":5},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1589348017228,"hash":"bb405e9083c11ec8b3e52c1eff2cfdee2b40dab6"}